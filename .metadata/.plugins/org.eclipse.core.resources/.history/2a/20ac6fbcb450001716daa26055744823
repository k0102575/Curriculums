package bitcamp.java93.util;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.RequestDispatcher;
import javax.servlet.http.HttpServletRequest;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

public class MultiPartFormProcessor {
  public static Map<String,FileItem> parse(HttpServletRequest request) throws Exception {
    DiskFileItemFactory partFactory = new DiskFileItemFactory();

    ServletFileUpload partParser = new ServletFileUpload(partFactory);

    try {
      List<FileItem> partList = partParser.parseRequest(req);
      HashMap<String, FileItem> partMap = new HashMap<>();
      for (FileItem part : partList) {
        partMap.put(part.getFieldName(), part);
      }
    } catch (Exception e){
      req.setAttribute("error", e);
      RequestDispatcher rd = req.getRequestDispatcher("/error");
      rd.forward(req, res);
      return;
    }
  }
}
