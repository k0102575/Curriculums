/* 소켓 프로그래밍: 파일 전송 클라이언트 프로그램 */

package step18;

import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.DataInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.PrintStream;
import java.net.ServerSocket;
import java.net.Socket;

public class Test04_2 {
  public static void main(String[] args) throws IOException {

    System.out.println("step18 Test04_2 클라이언트 실행중");
    System.out.println();

    if (args.length < 1) {
      System.out.println("[사용법] > java -cp bin step18.Test04_2 서버주소 포트번호 파일명");
      return;
    }
    
    File file = new File(args[2]);
    BufferedInputStream fileIn = new BufferedInputStream(new FileInputStream(file));
    
    
    Socket socket = new Socket(args[0], Integer.parseInt(args[1]));
    DataInputStream in = new DataInputStream(new BufferedInputStream(socket.getInputStream()));
    PrintStream out = new PrintStream(socket.getOutputStream());

    String filename = in.readUTF();
    long length = in.readLong();

      try 
      (
      BufferedOutputStream fileout = new BufferedOutputStream(new FileOutputStream("ㅅ"));
      )
      {
      for (int i =0; i < length; i++){
        fileout.write(in.read());
      }
      fileout.flush();
      } catch (Exception e) {
        System.out.println("파일 저장 중 오류 발생!");
      }
      out.println("ok" );
      
      
  }  // main
}
